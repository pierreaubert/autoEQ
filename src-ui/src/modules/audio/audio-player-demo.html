<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player Demo</title>
    <link rel="stylesheet" href="src/modules/audio/audio-player.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-secondary);
        }

        .demo-section h2 {
            margin-top: 0;
            color: var(--text-primary);
        }

        .demo-section p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
        }

        .btn:hover {
            background: var(--bg-accent);
        }

        .btn.active {
            background: var(--button-primary);
            color: white;
            border-color: var(--button-primary);
        }

        .file-input {
            margin: 10px 0;
        }

        .eq-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .eq-band {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
        }

        .eq-band label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .eq-band input {
            width: 100%;
            margin-bottom: 5px;
        }

        .log {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-entry.error {
            color: var(--danger-color);
        }

        .log-entry.success {
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>Audio Player Demo</h1>
        <p>This demo showcases the standalone audio player module extracted from the AutoEQ application.</p>

        <!-- Basic Audio Player -->
        <div class="demo-section">
            <h2>Basic Audio Player</h2>
            <p>Full-featured audio player with EQ controls, spectrum analyzer, and demo tracks.</p>
            <div id="audio-player-basic"></div>
        </div>

        <!-- Compact Audio Player -->
        <div class="demo-section">
            <h2>Compact Audio Player</h2>
            <p>Compact version without spectrum analyzer and frequency labels.</p>
            <div id="audio-player-compact"></div>
        </div>

        <!-- Custom Configuration -->
        <div class="demo-section">
            <h2>Custom Configuration</h2>
            <p>Audio player with custom settings and external file loading.</p>

            <div class="controls">
                <button class="btn" id="toggle-eq">Toggle EQ</button>
                <button class="btn" id="toggle-spectrum">Toggle Spectrum</button>
                <button class="btn" id="add-filter">Add EQ Filter</button>
                <button class="btn" id="clear-filters">Clear Filters</button>
            </div>

            <div class="file-input">
                <label for="audio-file">Load Audio File:</label>
                <input type="file" id="audio-file" accept="audio/*">
            </div>

            <div id="audio-player-custom"></div>

            <!-- EQ Controls -->
            <div class="eq-controls" id="eq-controls">
                <!-- EQ bands will be added dynamically -->
            </div>
        </div>

        <!-- Event Log -->
        <div class="demo-section">
            <h2>Event Log</h2>
            <p>Real-time events from the audio players.</p>
            <div class="log" id="event-log"></div>
            <button class="btn" id="clear-log">Clear Log</button>
        </div>
    </div>

    <script type="module">
        import { AudioPlayer } from './src/modules/audio/audio-player.js';

        // Event logging
        const eventLog = document.getElementById('event-log');
        const logEvent = (message, type = 'info') => {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
        };

        // Clear log button
        document.getElementById('clear-log').addEventListener('click', () => {
            eventLog.innerHTML = '';
        });

        // Basic Audio Player
        const basicPlayer = new AudioPlayer(
            document.getElementById('audio-player-basic'),
            {
                enableEQ: true,
                enableSpectrum: true,
                showProgress: true,
                showFrequencyLabels: true,
                compactMode: false
            },
            {
                onPlay: () => logEvent('Basic player: Started playing', 'success'),
                onStop: () => logEvent('Basic player: Stopped playing'),
                onEQToggle: (enabled) => logEvent(`Basic player: EQ ${enabled ? 'enabled' : 'disabled'}`),
                onTrackChange: (track) => logEvent(`Basic player: Changed to track "${track}"`),
                onError: (error) => logEvent(`Basic player error: ${error}`, 'error')
            }
        );

        // Compact Audio Player
        const compactPlayer = new AudioPlayer(
            document.getElementById('audio-player-compact'),
            {
                enableEQ: false,
                enableSpectrum: false,
                showProgress: true,
                showFrequencyLabels: false,
                compactMode: true
            },
            {
                onPlay: () => logEvent('Compact player: Started playing', 'success'),
                onStop: () => logEvent('Compact player: Stopped playing'),
                onTrackChange: (track) => logEvent(`Compact player: Changed to track "${track}"`),
                onError: (error) => logEvent(`Compact player error: ${error}`, 'error')
            }
        );

        // Custom Audio Player
        const customPlayer = new AudioPlayer(
            document.getElementById('audio-player-custom'),
            {
                enableEQ: true,
                enableSpectrum: true,
                showProgress: true,
                showFrequencyLabels: true,
                maxFilters: 5,
                demoTracks: {
                    'test1': '/demo-audio/classical.wav',
                    'test2': '/demo-audio/jazz.wav'
                }
            },
            {
                onPlay: () => logEvent('Custom player: Started playing', 'success'),
                onStop: () => logEvent('Custom player: Stopped playing'),
                onEQToggle: (enabled) => logEvent(`Custom player: EQ ${enabled ? 'enabled' : 'disabled'}`),
                onTrackChange: (track) => logEvent(`Custom player: Changed to track "${track}"`),
                onError: (error) => logEvent(`Custom player error: ${error}`, 'error')
            }
        );

        // Custom controls
        document.getElementById('toggle-eq').addEventListener('click', () => {
            const enabled = !customPlayer.isEQEnabled();
            customPlayer.setEQEnabled(enabled);
            document.getElementById('toggle-eq').textContent = `EQ: ${enabled ? 'ON' : 'OFF'}`;
        });

        document.getElementById('toggle-spectrum').addEventListener('click', (e) => {
            // This would require extending the AudioPlayer API
            logEvent('Spectrum toggle not implemented in current API');
        });

        // EQ Filter Management
        let filterCount = 0;
        const eqControlsContainer = document.getElementById('eq-controls');

        const createEQBand = (frequency = 1000, q = 1, gain = 0) => {
            const bandDiv = document.createElement('div');
            bandDiv.className = 'eq-band';
            bandDiv.innerHTML = `
                <label>Band ${++filterCount}</label>
                <label>Frequency (Hz)</label>
                <input type="number" class="freq-input" value="${frequency}" min="20" max="20000">
                <label>Q Factor</label>
                <input type="number" class="q-input" value="${q}" min="0.1" max="10" step="0.1">
                <label>Gain (dB)</label>
                <input type="number" class="gain-input" value="${gain}" min="-20" max="20" step="0.1">
                <button class="btn remove-band">Remove</button>
            `;

            const updateFilters = () => {
                const bands = eqControlsContainer.querySelectorAll('.eq-band');
                const filters = Array.from(bands).map(band => ({
                    frequency: parseFloat(band.querySelector('.freq-input').value),
                    q: parseFloat(band.querySelector('.q-input').value),
                    gain: parseFloat(band.querySelector('.gain-input').value)
                }));
                customPlayer.updateFilterParams(filters);
                logEvent(`Updated EQ with ${filters.length} filters`);
            };

            bandDiv.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', updateFilters);
            });

            bandDiv.querySelector('.remove-band').addEventListener('click', () => {
                bandDiv.remove();
                updateFilters();
            });

            eqControlsContainer.appendChild(bandDiv);
            updateFilters();
        };

        document.getElementById('add-filter').addEventListener('click', () => {
            createEQBand();
        });

        document.getElementById('clear-filters').addEventListener('click', () => {
            eqControlsContainer.innerHTML = '';
            filterCount = 0;
            customPlayer.updateFilterParams([]);
            logEvent('Cleared all EQ filters');
        });

        // File loading
        document.getElementById('audio-file').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                try {
                    await customPlayer.loadAudioFile(file);
                    logEvent(`Loaded audio file: ${file.name}`, 'success');
                } catch (error) {
                    logEvent(`Failed to load file: ${error}`, 'error');
                }
            }
        });

        // Initialize with some default EQ bands
        createEQBand(100, 1, 0);
        createEQBand(1000, 1, 0);
        createEQBand(10000, 1, 0);

        logEvent('Audio Player Demo initialized', 'success');
    </script>
</body>
</html>
