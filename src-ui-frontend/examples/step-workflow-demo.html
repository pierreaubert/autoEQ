<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Step Workflow Demo - Navigator + Container</title>
    <link rel="stylesheet" href="/styles.css" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        overflow: hidden;
      }

      #app {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100%;
      }

      #nav-container {
        flex-shrink: 0;
      }

      #content-container {
        flex: 1;
        min-height: 0;
        background: var(--bg-primary);
      }

      /* Step-specific styles */
      .step-header {
        margin: 0 0 var(--spacing-lg) 0;
        color: var(--text-primary);
        font-size: 1.8rem;
        font-weight: 600;
      }

      .step-description {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: var(--spacing-lg);
      }

      .info-box {
        background: var(--bg-secondary);
        border-left: 4px solid var(--info-color);
        padding: var(--spacing-lg);
        border-radius: var(--radius);
        margin: var(--spacing-lg) 0;
      }

      .info-box h4 {
        margin: 0 0 var(--spacing-sm) 0;
        color: var(--text-primary);
      }

      .info-box ul {
        margin: var(--spacing-sm) 0 0 0;
        padding-left: var(--spacing-xl);
        color: var(--text-secondary);
      }

      .action-buttons {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
      }

      .action-btn {
        padding: var(--spacing-md) var(--spacing-xl);
        background: var(--button-primary);
        color: white;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .action-btn:hover {
        background: var(--button-primary-hover);
      }

      .action-btn.secondary {
        background: var(--button-secondary);
      }

      .action-btn.secondary:hover {
        background: var(--button-secondary-hover);
      }

      .placeholder-content {
        background: var(--bg-secondary);
        border: 2px dashed var(--border-color);
        border-radius: var(--radius);
        padding: var(--spacing-xl);
        text-align: center;
        color: var(--text-secondary);
        margin-top: var(--spacing-lg);
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="nav-container"></div>
      <div id="content-container">
        <!-- Step content will be injected here -->
        <div data-step="1" id="step1-container">
          <!-- UseCaseSelector component will be initialized here -->
        </div>

        <div data-step="2" id="step2-container">
          <!-- DataAcquisitionStep component will be initialized here -->
        </div>

        <div data-step="3" id="step3-container">
          <!-- OptimizationStep component will be initialized here -->
        </div>

        <div data-step="4" id="step4-container">
          <!-- ListeningStep component will be initialized here -->
        </div>

        <div data-step="5" id="step5-container">
          <!-- SavingStep component will be initialized here -->
        </div>
      </div>
    </div>

    <script type="module">
      import { StepNavigator } from "../modules/step-navigator.ts";
      import { StepContainer } from "../modules/step-container.ts";
      import { UseCaseSelector } from "../modules/use-case-selector.ts";
      import { DataAcquisitionStep } from "../modules/data-acquisition-step.ts";
      import { OptimizationStep } from "../modules/optimization-step.ts";
      import { ListeningStep } from "../modules/listening-step.ts";
      import { SavingStep } from "../modules/saving-step.ts";

      // Initialize steps configuration
      const steps = [
        { id: 1, label: "Choose Use Case", shortLabel: "Use Case", enabled: true },
        { id: 2, label: "Data Acquisition", shortLabel: "Data", enabled: false },
        { id: 3, label: "Optimization", shortLabel: "Optimize", enabled: false },
        { id: 4, label: "Listening", shortLabel: "Listen", enabled: false },
        { id: 5, label: "Saving", shortLabel: "Save", enabled: false },
      ];

      // Initialize Navigator
      const navContainer = document.getElementById("nav-container");
      const navigator = new StepNavigator(navContainer, {
        steps,
        currentStep: 1,
        onStepChange: (stepId) => {
          console.log("âœ¨ Step changed to:", stepId);
          container.goToStep(stepId);
        },
        onPrevious: () => console.log("â¬…ï¸ Previous clicked"),
        onNext: () => console.log("âž¡ï¸ Next clicked"),
      });

      // Initialize Container
      const contentContainer = document.getElementById("content-container");
      const container = new StepContainer(contentContainer, {
        currentStep: 1,
        animationDuration: 300,
        onBeforeStepChange: (fromStep, toStep) => {
          console.log(`ðŸ”„ Transitioning from step ${fromStep} to ${toStep}`);
          return true; // Allow transition
        },
        onAfterStepChange: (stepId) => {
          console.log(`âœ… Now on step ${stepId}`);
          // Sync navigator
          navigator.goToStep(stepId);
        },
      });

      // Initialize Use Case Selector (Step 1)
      const step1Container = document.getElementById("step1-container");
      const useCaseSelector = new UseCaseSelector(step1Container, {
        onSelect: (useCase) => {
          console.log("ðŸ“± Selected use case:", useCase);

          // Enable next steps after selection
          steps.forEach((step) => {
            if (step.id > 1) {
              step.enabled = true;
              navigator.setStepEnabled(step.id, true);
            }
          });

          // Set the default data source based on use case
          if (useCase === "speaker") {
            dataAcquisitionStep.setSource("speaker");
          } else if (useCase === "headphone") {
            dataAcquisitionStep.setSource("headphone");
          } else if (useCase === "capture") {
            dataAcquisitionStep.setSource("capture");
          } else if (useCase === "file") {
            dataAcquisitionStep.setSource("file");
          }

          // Optionally auto-advance to next step after selection
          setTimeout(() => {
            if (confirm(`Use case "${useCase}" selected!\n\nWould you like to proceed to Data Acquisition?`)) {
              navigator.goToStep(2);
            }
          }, 300);
        },
      });

      // Initialize Data Acquisition Step (Step 2)
      const step2Container = document.getElementById("step2-container");
      const dataAcquisitionStep = new DataAcquisitionStep(step2Container, {
        onSourceChange: (source) => {
          console.log("ðŸ“Š Data source changed to:", source);
        },
        onDataReady: (source) => {
          console.log("âœ… Data ready from source:", source);
          // Could auto-enable Step 3 here
        },
      });

      // Initialize Optimization Step (Step 3)
      const step3Container = document.getElementById("step3-container");
      const optimizationStep = new OptimizationStep(step3Container, {
        onOptimizationStart: () => {
          console.log("ðŸš€ Optimization started");
          // Could show progress modal here
        },
        onOptimizationComplete: () => {
          console.log("âœ… Optimization complete");
          // Enable Step 4 after completion
          steps[3].enabled = true; // Step 4 (index 3)
          navigator.setStepEnabled(4, true);

          // Ask if user wants to proceed
          setTimeout(() => {
            if (confirm("Optimization complete!\n\nWould you like to proceed to test your EQ?")) {
              navigator.goToStep(4);
            }
          }, 500);
        },
      });

      // Initialize Listening Step (Step 4)
      const step4Container = document.getElementById("step4-container");
      const listeningStep = new ListeningStep(step4Container, {
        onContinue: () => {
          console.log("ðŸ“¦ Moving to save step");
          // Enable Step 5
          steps[4].enabled = true; // Step 5 (index 4)
          navigator.setStepEnabled(5, true);

          // Navigate to Step 5
          navigator.goToStep(5);
        },
      });

      // Initialize Saving Step (Step 5)
      const step5Container = document.getElementById("step5-container");
      const savingStep = new SavingStep(step5Container, {
        onStartNew: () => {
          console.log("ðŸ”„ Starting new optimization");

          // Reset all steps except Step 1
          steps.forEach((step, index) => {
            if (index > 0) {
              step.enabled = false;
              navigator.setStepEnabled(step.id, false);
            }
          });

          // Navigate back to Step 1
          navigator.goToStep(1);

          // Optionally refresh components
          useCaseSelector.clearSelection();
        },
      });

      // Demo functions
      window.demo = {
        navigator,
        container,
        useCaseSelector,
        dataAcquisitionStep,
        optimizationStep,
        listeningStep,
        savingStep,
      };

      console.log("ðŸš€ Step Workflow Demo loaded!");
      console.log("ðŸ’¡ Try clicking a use case card to enable all steps");
    </script>
  </body>
</html>
